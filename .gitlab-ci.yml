stages:
  - install
  - build
  - publish

variables:
  PARENT_PIPELINE_ID: $CI_PIPELINE_ID

include:
  - project: devops/pipes
    file: /templates/go-install.gitlab-ci.yml
    ref: main

  - project: devops/pipes
    file: /templates/go-build.gitlab-ci.yml
    ref: main

publish:
  stage: publish
  trigger:
    include:
      - project: devops/gitlab-pipes
        file: /templates/docker-build-with-artifacts-dockerhub.gitlab-ci.yml
        ref: main
    strategy: depend
  variables:
    DOCKERFILE_CONTEXT: .
    DOCKER_IMAGE_NAME: cenk1cenk2/nginx-ingress
    IMAGE_TAGS: latest
  only:
    refs:
      - main
      - tags
